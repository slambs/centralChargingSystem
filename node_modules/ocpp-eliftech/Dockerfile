FROM node:lts

RUN npm i -g pm2 babel-cli

COPY . /srv

RUN cd /srv/frontend && npm i && npm run build && \
    cd /srv  && npm i && npm run build

WORKDIR /srv

EXPOSE 80
EXPOSE 9220

CMD ["pm2-runtime", "/srv/ecosystem.config.js"]
